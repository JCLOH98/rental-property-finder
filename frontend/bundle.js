(()=>{const e=["Johor","Kedah","Kelantan","Kuala Lumpur","Labuan","Melaka","Negeri Sembilan","Pahang","Penang","Perak","Perlis","Putrajaya","Sabah","Sarawak","Selangor","Terengganu"],t=["johor","kedah","kelantan","kuala-lumpur","labuan","melaka","negeri-sembilan","pahang","penang","perak","perlis","putrajaya","sabah","sarawak","selangor","terengganu"],n=["2hh35","x5i6n","8j2mm","58jok","aef3q","5kmak","r9fza","9ycjt","5qvq6","zagd9","zop7y","068mt","cc02j","dh4eg","45nk1","0eu1z"];let a=L.map("map-view").setView([3.051487,101.5823339],13),o=new L.Control.Geocoder.Nominatim,r=L.layerGroup().addTo(a);L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(a),L.Control.geocoder({geocoder:o,defaultMarkGeocode:!1}).addTo(a).on("markgeocode",(function(e){const t=e.geocode;console.log(t),L.marker(t.center).addTo(r).bindPopup(t.name).openPopup()}));let l="";function i(e,t,n,a,o,r){let l=document.createElement("div");return l.classList.add("property-div"),l.innerHTML+=`<h6>${t}</h6>`,l.innerHTML+=`<div>${n}</div>`,l.innerHTML+=`<div>${a}</div>`,l.innerHTML+=`<div>${o}</div>`,l.innerHTML+=`<a href="${r}" target="blank">${r}</a>`,l.addEventListener("click",(async()=>{await c(t),document.getElementById("to-location").value=t})),l}const d=async(e,t)=>{try{const n=await o.geocode(e),l=document.getElementById(t+"-location-container");l.classList.add("relative");const i=document.getElementById(t+"-location"),d=document.getElementById(t+"-location-option"),c=document.createElement("button");c.innerText="CLOSE",c.addEventListener("click",(()=>{l.classList.remove("relative"),d.innerHTML="",d.classList.remove("flex"),d.classList.remove("visible"),d.classList.add("hidden"),d.classList.add("invisible")})),n.length>0?n.length>1?(n.forEach(((e,t)=>{const n=document.createElement("button");n.classList.add("location-option-button"),n.innerText=e.name,n.addEventListener("click",(()=>{l.classList.remove("relative"),d.innerHTML="",d.classList.remove("flex"),d.classList.remove("visible"),d.classList.add("hidden"),d.classList.add("invisible"),i.value=e.name,a.setView(e.center,13),L.marker(e.center).addTo(r).bindPopup(e.name).openPopup()})),d.appendChild(n)})),d.classList.remove("hidden"),d.classList.remove("invisible"),d.classList.add("flex"),d.classList.add("visible"),d.appendChild(c)):(a.setView(n[0].center,13),L.marker(n[0].center).addTo(r).bindPopup(n[0].name).openPopup()):(d.innerText="No result found",d.classList.remove("hidden"),d.classList.remove("invisible"),d.classList.add("flex"),d.classList.add("visible"),d.appendChild(c))}catch(e){document.getElementById("result").innerText="Error:"+e}},c=async e=>{try{const t=await o.geocode(e);if(t.length>0)return a.setView(t[0].center,13),L.marker(t[0].center).addTo(r).bindPopup(t[0].name).openPopup(),t[0].center}catch(e){alert("Error:"+e)}};(()=>{let t=document.getElementById("state");e.sort();for(let n of e){const e=document.createElement("option");e.innerText=n,e.setAttribute("value",n.toLowerCase().replace(" ","-")),"Kuala Lumpur"==n&&e.setAttribute("selected",!0),t.appendChild(e)}})(),document.getElementById("search-button").addEventListener("click",(()=>{const e=document.getElementById("country").innerText,a=document.getElementById("state").value,o=document.getElementById("bedrooms").value,r=document.getElementById("min-price").value,l=document.getElementById("max-price").value,d=document.getElementById("sort-by").value,c=document.getElementById("search-term").value;document.getElementById("result").innerText="","Malaysia"==e&&(async(e,a,o,r,l,d)=>{let c=n[t.indexOf(e)];document.getElementById("use-state").checked||(e="",c="");let s=`http://localhost:8000/get_rental?state=${e}&region_code=${c}&min_price=${o}&max_price=${r}&bedrooms=${a}&sort_by=${l}&search_term=${d}`;try{document.getElementById("result").innerText="Searching...";const e=await fetch(s);if(!e.ok)throw new Error("Network response was not ok");const t=await e.json();document.getElementById("result").innerText="";for(const e in t)if(t.hasOwnProperty(e)){const n=t[e];document.getElementById("result").appendChild(i(0,n.title,n.location,n.price,n.room_info,n.link))}}catch(e){console.error("Error:",e),document.getElementById("result").innerText="Error:"+e}})(a,o,r,l,d,c)})),document.getElementById("from-location").addEventListener("keydown",(e=>{"Enter"===e.key&&d(document.getElementById("from-location").value,"from")})),document.getElementById("to-location").addEventListener("keydown",(e=>{"Enter"===e.key&&d(document.getElementById("to-location").value,"to")})),document.getElementById("get-route").addEventListener("click",(async()=>{r.clearLayers(),l&&a.removeControl(l);const e=await c(document.getElementById("from-location").value),t=await c(document.getElementById("to-location").value);l=L.Routing.control({waypoints:[L.latLng(e.lat,e.lng),L.latLng(t.lat,t.lng)],router:L.Routing.osrmv1({profile:"car"}),lineOptions:{styles:[{color:"#0066cc",weight:8,opacity:1}]}}).addTo(a)})),document.getElementById("clear-map").addEventListener("click",(async()=>{r.clearLayers(),l&&a.removeControl(l)}))})();